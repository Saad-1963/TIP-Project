import axios from 'axios';
import React, { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';

const UrlDetection = () => {

  const {user,logout} = useAuth()
  const naviagte  = useNavigate()
  console.log("urlDection",user)

  const [domain, setDomain] = useState('');
  const [scanResults, setScanResults] = useState(null);
  const [error, setError] = useState('');

  const handleClick = () =>{

logout()

naviagte("/")
  }
  

  const handleScan = async (e) => {
    e.preventDefault();

    try {
      // Make API call to classify URL
      const res = await axios.get(`http://127.0.0.1:8000/prediction_api/`, {
        params: { url: domain, u_id: 1 }, // Pass the domain and user_id
      });

      // Update scanResults state with the response
      setScanResults({
        url: res.data.url,
        result: res.data.result, // 'phishing', 'clean', etc.
      });

      // Clear previous error if any
      setError('');
    } catch (err) {
      // Handle error (if API fails)
      console.error('Error scanning the URL:', err);
      setError('Failed to scan the URL. Please try again.');
      setScanResults(null);
    }
  };

  return (
    <div className="bg-gray-900 min-h-screen text-white">
      <header className="bg-gray-800 p-4 flex justify-between items-center">
        <div className="flex items-center">
          <svg className="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M10 1.944A11.954 11.954 0 012.166 5C2.056 5.649 2 6.319 2 7c0 5.225 3.34 9.67 8 11.317C14.66 16.67 18 12.225 18 7c0-.682-.057-1.35-.166-2.001A11.954 11.954 0 0110 1.944zM11 14a1 1 0 11-2 0 1 1 0 012 0zm0-7a1 1 0 10-2 0v3a1 1 0 102 0V7z" clipRule="evenodd" />
          </svg>
          <h1 className="text-xl font-bold">XGBoost Malware Scanner</h1>
        </div>
        <nav>
          
        <button onClick={handleClick}>Logout</button>
        </nav>
      </header>

      <main className="container mx-auto p-4">
        <section className="bg-gray-800 rounded-lg p-6 mb-6">
          <h2 className="text-xl font-bold mb-4">Scan for Malware</h2>
          <form onSubmit={handleScan}>
            <input
              type="text"
              placeholder="Enter Domain"
              className="w-full bg-gray-700 rounded p-2 mb-2"
              value={domain}
              onChange={(e) => setDomain(e.target.value)}
            />
            <button
              type="submit"
              className="w-full bg-purple-600 hover:bg-purple-700 rounded p-2 mt-2"
            >
              Scan
            </button>
          </form>

          {error && <p className="text-red-500 mt-4">{error}</p>}
        </section>

        {scanResults && (
          <section className="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 className="text-xl font-bold mb-4">Scan Results</h2>
            <p>Domain: {scanResults.url}</p>
            <p>Result: {scanResults.result}</p>
          </section>
        )}

        <section className="bg-gray-800 rounded-lg p-6">
          <h2 className="text-xl font-bold mb-4">Frequently Asked Questions</h2>
          <div className="mb-4">
            <h3 className="font-bold">Q: How does the malware scanner work?</h3>
            <p>A: The scanner uses advanced machine learning algorithms to detect potential threats in various inputs including IP addresses, domains, and file extensions.</p>
          </div>
          <div>
            <h3 className="font-bold">Q: What should I do if malware is detected?</h3>
            <p>A: Follow the recommended steps provided by the scanner to clean your system and ensure the security of your network.</p>
          </div>
        </section>
      </main>

      <footer className="bg-gray-800 p-4 mt-6">
        <div className="container mx-auto text-center">
          <p>Â© 2023 XGBoost Malware Scanner. All rights reserved.</p>
          <div className="mt-2">
            <a href="" className="mx-2">Privacy Policy</a>
            <a href="" className="mx-2">Terms of Service</a>
          </div>
          <p className="mt-2">Contact us: support@xgboostscanner.com</p>
        </div>
      </footer>
    </div>
  );
};

export default UrlDetection;
